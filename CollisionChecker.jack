/** Implements collision checking logic */
class CollisionChecker
{
    /** Check 1 bullet against all invaders 
      * And remove it if collision found
      * Maybe we change this from void to boolean to allow the calling function
      * to know if we should advance to the next item in the list or stay b/c
      * the current item has already been replaced with the next */
    function void checkBulletCollisions(BulletList bulletToCheck, BulletList bullets, InvaderList invaders)
    {
        var Invader currentInvader;
        var Bullet bulletData;
        var InvaderList invadersHead;

        let bulletData = bulletToCheck.getData();
        let invadersHead = invaders;

        // Return early if this is an empty list
        if (bulletData = null)
        {
            return;
        }

        while (~(invaders = null))
        {
            // logging
            do Logger.logString("Getting Invader Data ", null);

            let currentInvader = invaders.getData();

            // logging
            do Logger.logString("checking collision ", null);

            if (CollisionChecker.checkCollision(bulletData, currentInvader))
            {
                do Logger.logString("Removing here", null);
                do bullets.remove(bulletToCheck);
                do invadersHead.remove(invaders);
                return;
            }

            // logging
            do Logger.logString("Finished checking", null);

            let invaders = invaders.getNext();
        }
        return;
    }

    /** Check a collision between 1 bullet and 1 invader 
      * using simple bounding box collision as I understand it 
      * see Intelligent 2D Collision and Pixel Perfect Precision on gamedev.net */
    function boolean checkCollision(Bullet bullet, Invader invader)
    {
        // Set up bounding boxes
        var int bulletTop, bulletBottom, bulletLeft, bulletRight;
        var int invaderTop, invaderBottom, invaderLeft, invaderRight;
        let bulletTop = bullet.getY();
        let bulletLeft = bullet.getX() + 7; // 7 being the center of the sprite
        let bulletBottom = bullet.getY() + bullet.getHeight();
        let bulletRight = bullet.getX() + 7 + bullet.getWidth();
        let invaderTop = invader.getY();
        let invaderLeft = invader.getX();
        let invaderBottom = invader.getY() + invader.getHeight();
        let invaderRight = invader.getX() + invader.getWidth();

        // logging
        do Logger.logInt(bulletLeft, "bulletLeft");
        do Logger.logInt(invaderRight, "invaderRight");
        do Sys.wait(500);
        
        // Check horizontal collision
        if ((bulletLeft > invaderRight)
            | (invaderLeft > bulletRight))
        {
            // logging
            do Logger.logString("Left or right; exiting", null);

            return false;
        }

        // Check vertical collision
        // Less than since 0,0 starts in top right corner
        if ((bulletBottom < invaderTop)
            | (invaderBottom < bulletTop))
        {
            // logging
            do Logger.logString("Below or above; exiting", null);

            return false;
        }
        do Logger.logString("Hit", null);
        return true;
    }
}